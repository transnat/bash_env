---
- name: 'Install dependencies'
  become: true
  tags:
      - 'always'
  block:
      - name: 'Install APT packages'
        when: "ansible_os_family == 'Debian'"
        tags:
            - 'apt'
        block:
            - name: 'Update APT cache'
              ansible.builtin.apt:
                  update_cache: true
                  cache_valid_time: 3600
                  name: '*'

            - name: 'Install APT packages'
              ansible.builtin.apt:
                  name: '{{ packages_apt }}'

      - name: 'Install DNF packages'
        when: "ansible_os_family == 'RedHat'"
        tags:
            - 'dnf'
        ansible.builtin.dnf:
            name: '{{ packages_dnf }}'
            state: 'present'

      - name: 'Install Pacman packages'
        when: "ansible_os_family == 'Archlinux'"
        tags:
            - 'pacman'
        community.general.pacman:
            name: '{{ packages_pacman }}'
            state: 'present'
...
