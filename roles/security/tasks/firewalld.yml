---
- name: 'Set up system firewall.'
  become: true
  tags:
      - 'firewall'
  block:
      - name: 'Debian'
        when: ansible_os_family == 'Debian'
        ansible.builtin.apt:
            name: '{{ item }}'
            state: 'present'
        loop:
            - 'firewalld'
            - 'python3-pip'

      - name: 'Red Hat'
        when: ansible_os_family == 'RedHat'
        ansible.builtin.dnf:
            name: '{{ item }}'
            state: 'present'
        loop:
            - 'firewalld'
            - 'python3-pip'

      - name: 'Arch'
        when: ansible_os_family == 'ArchLinux'
        community.general.pacman:
            name: '{{ item }}'
            state: 'present'
        loop:
            - 'firewalld'
            - 'python-pip'

      - name: 'Install python3-firewall.'
        ansible.builtin.pip:
            name: 'firewall'

      - name: 'Start firewalld service.'
        ansible.builtin.systemd:
            name: 'firewalld.service'
            state: 'started'
            enabled: true

      - name: 'Block all incoming connections.'
        ansible.posix.firewalld:
            state: 'disabled'
            permanent: true
...
