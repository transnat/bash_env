---
- name: 'iptables'
  become: true
  tags:
      - 'firewall'
      - 'iptables'
  block:
      - name: 'Install iptables packages [APT]'
        when: "ansible_os_family == 'Debian'"
        tags:
            - 'apt'
        ansible.builtin.apt:
            name: '{{ item }}'
            state: 'present'
        loop:
            - 'iptables-persistent'
            - 'netfilter-persistent'

      - name: 'Drop all incoming traffic'
        ansible.builtin.iptables:
            action: 'insert'
            chain: 'INPUT'
            policy: 'DROP'
        notify: 'Restart iptables'
...
