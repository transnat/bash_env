#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Author:       Casey Sparks
# Date:         December 14, 2022
# Description:
'''
Check an endpoint and wipe local user data.
Should be cron on sensitive systems.
'''

from locale import setlocale, LC_ALL
from logging import getLogger, StreamHandler, INFO
from pathlib import Path
from shutil import rmtree
from socket import gethostname
from typing import NoReturn
from requests import get


log = getLogger()                                                   # Instantiate logger.

setlocale(LC_ALL, 'en_US.UTF-8')                                    # Set locale.
log.addHandler(StreamHandler())                                     # Log to screen.
log.setLevel(INFO)                                                  # Set log level.


def is_match() -> bool:
    '''Checks remote for hostname match and returns true if true.'''
    try:
        flag = eval(get(
            f'https://raw.githubusercontent.com/caseysparkz/haltandcatchfire/main/{gethostname()}'
        ).text.capitalize())

    except TypeError:
        flag = False

    log.debug(flag)

    return flag


def destroy_user_data() -> NoReturn:
    '''Wipe sensitive user data from disk.'''
    dir_list = [
        Path().home() / sub_dir
        for sub_dir
        in [
            'Documents',
            'Downloads',
            '.1password',
            '.aws',
            '.azure',
            '.azure',
            '.config',
            '.docker',
            '.env',
            '.google',
            '.kube',
            '.ssh',
            '.terraform.d',
            '.ykman'
        ]
    ]

    for directory in dir_list:
        rmtree(directory)
        log.debug(f'Removed {directory}.')


if __name__ == '__main__':
    if is_match():
        destroy_user_data()
